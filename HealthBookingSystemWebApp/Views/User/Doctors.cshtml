@{
    Layout = "_LayoutUser";
    ViewData["Title"] = "List of doctors";
}
<!-- Main Content -->
<div class="main-content">
    <!-- Header -->
    <header class="header">
        <h1 class="header-title">Find Doctors</h1>
        <div class="header-actions">
            <a asp-action="Profile" asp-controller="User" style="text-decoration: none;">
                <div class="user-profile">
                    <img src="@Model.AvatarUrl" alt="User" class="user-avatar">
                    <div class="user-info">
                        <h6>@Model.FullName</h6>
                        <p>Patient</p>
                    </div>
                </div>
            </a>
        </div>
    </header>

    <!-- Content -->
    <div class="content">
        <div class="doctors-container">
            <!-- Filters Sidebar -->
            <aside class="filters-sidebar">
                <div class="dashboard-card filters-card">
                    <div class="card-header">
                        <h5 class="card-title">
                            <i class="fas fa-sliders-h"></i> Filters
                        </h5>
                        <button class="btn btn-link btn-sm" onclick="clearAllFilters()">
                            <i class="fas fa-times"></i> Clear
                        </button>
                    </div>
                    <div class="card-content filters-content">
                        <!-- Specialty Filter -->
                        <div class="filter-group">
                            <label class="filter-label">
                                <i class="fas fa-stethoscope"></i> Specialty
                            </label>
                            <div class="filter-options">
                                <div class="form-check">
                                    <input class="form-check-input filter-checkbox"
                                           type="checkbox"
                                           value="all"
                                           id="specialtyAll"
                                           name="specialty-filter"
                                           checked>
                                    <label class="form-check-label" for="specialtyAll">
                                        All Specialties
                                    </label>
                                </div>

                                @foreach (var specialty in ViewBag.Specialties)
                                {
                                    <div class="form-check">
                                        <input class="form-check-input filter-checkbox"
                                               type="checkbox"
                                               value="@specialty.SpecialtyId"
                                               id="specialty-@specialty.SpecialtyId"
                                               name="specialty-filter">
                                        <label class="form-check-label" for="specialty-@specialty.SpecialtyId">
                                            @specialty.Name
                                        </label>
                                    </div>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            </aside>

            <!-- Doctors Grid -->
            <main class="doctors-main">
                <!-- Sort Options -->
                <div class="sort-bar">
                    <div class="results-info">
                        <span id="resultsCount">Showing all doctors</span>
                    </div>
                </div>

                <!-- Doctors Grid -->
                <div class="doctors-grid" id="doctorsGrid">
                    <partial name="Partials/UserPartials/_ListDoctor" model="ViewBag.Doctors"></partial>
                </div>
            </main>
        </div>
    </div>
</div>


<script>
    document.addEventListener('DOMContentLoaded', function () {
        const searchInput = document.getElementById('searchInput');
        const specialtyFilters = document.querySelectorAll('input[name="specialty-filter"]');
        const doctorCards = document.querySelectorAll('.doctor-card');

        searchInput.addEventListener('input', filterDoctors);
        specialtyFilters.forEach(cb => cb.addEventListener('change', filterDoctors));

        function filterDoctors() {
            const searchTerm = searchInput.value.toLowerCase();

            // Lấy danh sách specialty đang được chọn
            const activeSpecialties = [...specialtyFilters]
                .filter(cb => cb.checked && cb.value !== "all")
                .map(cb => cb.value);

            doctorCards.forEach(card => {
                const name = card.querySelector('.doctor-name').textContent.toLowerCase();
                const specialtyName = card.querySelector('.doctor-specialty').textContent.toLowerCase();
                const specialtyId = card.getAttribute('data-specialty');

                const matchSearch =
                    name.includes(searchTerm) ||
                    specialtyName.includes(searchTerm);

                const matchSpecialty =
                    activeSpecialties.length === 0 ||
                    activeSpecialties.includes(specialtyId);

                card.style.display = (matchSearch && matchSpecialty)
                    ? "block"
                    : "none";
            });
        }
    });
    function bookWithDoctor(doctorId) {
        // Redirect to appointments page with pre-selected doctor
        window.location.href = `/User/Appointments?doctorId=${doctorId}`;
    }
</script>
