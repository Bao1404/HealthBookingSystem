﻿@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@model HealthBookingSystem.Models.ScheduleViewModel
@{
    Layout = "_LayoutDoctor";
    ViewData["Title"] = "Schedule";
}

<!-- Main Content -->
<div class="main-content">
    <!-- Header -->
    <header class="header">
        <h1 class="header-title">Schedule Management</h1>
        <div class="header-actions">
            <a class="user-profile" asp-action="Profile" asp-controller="Doctor" style="text-decoration: none;">
                <img src="@ViewBag.Doctor.User.AvatarUrl" alt="Doctor" class="user-avatar">
                <div class="user-info">
                    <h6 id="doctorName">@ViewBag.Doctor.User.FullName</h6>
                    <p>@ViewBag.Doctor.Specialty.Name</p>
                </div>
            </a>
        </div>
    </header>

    <!-- Content -->
    <div class="content">
        <!-- Schedule Overview -->
        <div class="dashboard-card">
            <div class="card-header">
                <h5 class="card-title">Weekly Schedule Overview</h5>
                <div class="schedule-controls">
                    <button class="btn btn-outline-secondary" onclick="previousWeek()">
                        <i class="fas fa-chevron-left"></i>
                    </button>
                    <span id="currentWeek">@Model.CurrentWeekDisplay</span>
                    <button class="btn btn-outline-secondary" onclick="nextWeek()">
                        <i class="fas fa-chevron-right"></i>
                    </button>
                </div>
            </div>
            <div class="card-content">
                <div class="schedule-grid" id="scheduleGrid">
                    @{
                        var days = new[] { "Sunday", "Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday" };
                        var timeSlots = new[] { "09:00", "09:30", "10:00", "10:30", "11:00", "11:30", "14:00", "14:30", "15:00", "15:30", "16:00", "16:30" };
                    }

                    <!-- Header row -->
                    <div class="schedule-grid-header">
                        <div class="schedule-time-header">Time</div>
                        @foreach (var day in days)
                        {
                            <div class="schedule-day-header">@day</div>
                        }
                    </div>

                    <!-- Time slot rows -->
                    @foreach (var time in timeSlots)
                    {
                        <div class="schedule-grid-row">
                            <div class="schedule-time-slot">@time</div>
                            @foreach (var day in days)
                            {
                                var daySchedule = Model.WeeklySchedule.FirstOrDefault(d => d.DayName == day);
                                var appointment = daySchedule?.Appointments.FirstOrDefault(a => a.TimeDisplay == time);
                                var availableSlot = daySchedule?.AvailableSlots.FirstOrDefault(s => s.TimeDisplay.StartsWith(time));

                                var cellClass = "schedule-cell";
                                string cellContent = "";

                                if (appointment != null)
                                {
                                    cellClass += " has-appointment";
                                    cellContent = $@"
                                                <div class='appointment-block'>
                                                <div class='appointment-patient'>{appointment.PatientName}</div>
                                                <span class='badge badge-{appointment.StatusColor}'>{appointment.Status}</span>
                                                </div>";
                                }
                                else if (availableSlot?.IsAvailable == true)
                                {
                                    cellClass += " available";
                                    cellContent = $@"<div class='available-slot'>Available</div>";
                                }
                                else
                                {
                                    cellClass += " unavailable";
                                    cellContent = "<div class='unavailable-slot'>Unavailable</div>";
                                }

                                <div class="@cellClass">@Html.Raw(cellContent)</div>
                            }
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

<script src="~/js/doctor/schedule.js"></script>